<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Colorpicker demo</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
</head>
<body>
    <canvas width="480" height="480" id="canvas_picker"></canvas>
    <div id="hex">HEX: <input type="text"></input></div>
    <div id="rgb">RGB: <input type="text"></input></div>
    <select id="lednum">
        <option value="all" selected="selected">All</option>
        <option value="even">Even</option>
        <option value="odd">Odd</option>
    </select>

	<div class="color" style="width: 50px; height: 50px; background-color: #000;"></div>


    <script type="text/javascript">
        $(document).ready(function(){
            for( var i = 0; i < 50; i++ ){
                $('#lednum').append('<option value="' + i + '">' + i + '</option>')
            }
        });

    	var canvas = document.getElementById('canvas_picker').getContext('2d');

    	// create an image object and get itâ€™s source
    	var img = new Image();
    	img.src = 'colors2.png';

    	// copy the image to the canvas
    	$(img).load(function(){
            canvas.drawImage(img,0,0);
    	});

    	// http://www.javascripter.net/faq/rgbtohex.htm
    	function rgbToHex(R,G,B) {
            return toHex(R)+toHex(G)+toHex(B)
        }

    	function toHex(n) {
            n = parseInt(n,10);
            if (isNaN(n)) return "00";
            n = Math.max(0,Math.min(n,255));
            return "0123456789ABCDEF".charAt((n-n%16)/16)  + "0123456789ABCDEF".charAt(n%16);
    	}

    	$('#canvas_picker').click(function(event){
            // getting user coordinates
            var x = event.pageX - this.offsetLeft;
            var y = event.pageY - this.offsetTop;
            // getting image data and RGB values
            var img_data = canvas.getImageData(x, y, 1, 1).data;
            var R = img_data[0];
            var G = img_data[1];
            var B = img_data[2];  var rgb = R + ',' + G + ',' + B;
            // convert RGB to HEX
            var hex = rgbToHex(R,G,B);
            // making the color the value of the input
            $('#rgb input').val(rgb);
            $('#hex input').val('#' + hex);

			$('.color').css('background-color', 'rgb(' + R + ',' + G + ',' + B + ')');

            var sendColor = R + '-' + G + '-' + B;

            var lednum = $('#lednum').val();

            if( lednum === "all" ){
                $.ajax({
                    url: 'http://localhost:4099/solid/' + sendColor,
                    type: 'GET',
                    success: function(res){
                        console.log(res);
                    }
                })
            } else {
                $.ajax({
                    url: 'http://localhost:4099/solid/' + sendColor + '/pixel/' + lednum,
                    type: 'GET',
                    success: function(res){
                        console.log(res);
                    }
                })
            }

    	});
    </script>
</body>
</html>
